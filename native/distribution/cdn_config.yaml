# CDN Configuration for Voice Model Distribution
# This configuration defines the CDN setup for distributing Piper voice models

cdn:
  provider: "cloudflare"  # or "aws-cloudfront", "azure-cdn", "custom"
  
  # Primary CDN endpoint
  primary:
    url: "https://cdn.ireader.org/voices"
    region: "global"
    cache_ttl: 86400  # 24 hours
    
  # Mirror endpoints for redundancy
  mirrors:
    - url: "https://mirror1.ireader.org/voices"
      region: "us-east"
      priority: 1
      
    - url: "https://mirror2.ireader.org/voices"
      region: "eu-west"
      priority: 2
      
    - url: "https://mirror3.ireader.org/voices"
      region: "ap-southeast"
      priority: 3

# Voice model catalog
catalog:
  url: "https://cdn.ireader.org/voices/catalog.json"
  update_interval: 3600  # Check for updates every hour
  
# Rate limiting configuration
rate_limiting:
  enabled: true
  
  # Per-IP limits
  per_ip:
    requests_per_minute: 10
    requests_per_hour: 100
    requests_per_day: 500
    
  # Per-user limits (authenticated)
  per_user:
    requests_per_minute: 20
    requests_per_hour: 200
    requests_per_day: 1000
    
  # Bandwidth limits
  bandwidth:
    max_concurrent_downloads: 3
    max_download_speed_mbps: 10  # Per connection
    
# Caching strategy
caching:
  # Browser caching
  browser_cache:
    voice_models: 2592000  # 30 days
    catalog: 3600  # 1 hour
    checksums: 86400  # 24 hours
    
  # CDN edge caching
  edge_cache:
    voice_models: 604800  # 7 days
    catalog: 1800  # 30 minutes
    
# Security settings
security:
  # HTTPS enforcement
  https_only: true
  
  # CORS configuration
  cors:
    allowed_origins:
      - "https://ireader.org"
      - "https://*.ireader.org"
    allowed_methods:
      - "GET"
      - "HEAD"
    max_age: 86400
    
  # Integrity verification
  integrity:
    require_checksum: true
    algorithm: "sha256"
    
# Monitoring and analytics
monitoring:
  enabled: true
  
  # Metrics to track
  metrics:
    - download_count
    - download_size
    - download_duration
    - error_rate
    - cache_hit_rate
    - bandwidth_usage
    
  # Alerting thresholds
  alerts:
    error_rate_threshold: 0.05  # 5%
    bandwidth_threshold_gbps: 100
    
# Geographic distribution
geo_distribution:
  # Automatic region selection
  auto_select: true
  
  # Region-specific endpoints
  regions:
    north_america:
      endpoint: "https://na.cdn.ireader.org/voices"
      countries: ["US", "CA", "MX"]
      
    europe:
      endpoint: "https://eu.cdn.ireader.org/voices"
      countries: ["GB", "DE", "FR", "ES", "IT"]
      
    asia_pacific:
      endpoint: "https://ap.cdn.ireader.org/voices"
      countries: ["JP", "CN", "KR", "IN", "AU"]
      
    south_america:
      endpoint: "https://sa.cdn.ireader.org/voices"
      countries: ["BR", "AR", "CL"]
